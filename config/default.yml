# frozen_string_literal: true
#
# Default configuration for rubocop-claude cops.
# This file is loaded automatically by the plugin.

AllCops:
  NewCops: disable
  SuggestExtensions: false

# =============================================================================
# Existing RuboCop Cops - Enable/Configure
# =============================================================================

# Warn on inline rubocop:disable comments - fix the issue instead
Style/DisableCopsWithinSourceCodeDirective:
  Enabled: true
  AllowedCops: []

# Enforce consistent class structure ordering
Layout/ClassStructure:
  Enabled: true
  ExpectedOrder:
    - module_inclusion
    - constants
    - public_class_methods
    - initializer
    - public_methods
    - protected_methods
    - private_methods
  Categories:
    module_inclusion:
      - include
      - prepend
      - extend

# Enforce TODO/FIXME format with uppercase and colon
Style/CommentAnnotation:
  Enabled: true
  Keywords:
    - TODO
    - FIXME
    - NOTE
    - HACK
    - OPTIMIZE
    - REVIEW
  RequireColon: true

# No debug statements left in code
Lint/Debugger:
  Enabled: true

# Method chaining with indented style (leading dot, 2-space indent)
Layout/MultilineMethodCallIndentation:
  Enabled: true
  EnforcedStyle: indented

# Flag defensive .try calls and excessive && nil checks
Style/SafeNavigation:
  Enabled: true
  AllowedMethods: []  # Don't allow try/try! - use &. or trust the code
  MaxChainLength: 1   # Consistent with NoOverlyDefensiveCode

# Flag overly complex methods
Metrics/CyclomaticComplexity:
  Enabled: true
  Max: 7

# Flag bloated methods
Metrics/AbcSize:
  Enabled: true
  Max: 17

# AI writes 80-line methods without blinking. 10 is plenty.
# CountAsOne prevents array literals from inflating the count.
Metrics/MethodLength:
  Enabled: true
  Max: 10
  CountComments: false
  CountAsOne: [array, hash, heredoc, method_call]

# AI creates god classes. 150 lines is generous but catches the worst offenders.
Metrics/ClassLength:
  Enabled: true
  Max: 150
  CountComments: false
  CountAsOne: [array, hash, heredoc, method_call]

# More than 5 params? Use an options hash or a parameter object.
Metrics/ParameterLists:
  Enabled: true
  Max: 5
  CountKeywordArgs: true
  MaxOptionalParameters: 3

# AI nests 5 levels deep instead of using early returns.
# Guard clauses are more readable: `return unless valid?` at the top.
Style/GuardClause:
  Enabled: true
  MinBodyLength: 1

# Ruby returns the last expression. Explicit `return` on the last line is noise.
# AllowMultipleReturnValues permits `return a, b` for tuple returns.
Style/RedundantReturn:
  Enabled: true
  AllowMultipleReturnValues: true

# ITEMS = ['a', 'b'] is mutable. Always .freeze constants.
# EnforcedStyle: strict requires freeze even for literals.
Style/MutableConstant:
  Enabled: true
  EnforcedStyle: strict

# Dead parameters after refactoring. Remove them or prefix with _ if interface requires.
Lint/UnusedMethodArgument:
  Enabled: true
  AllowUnusedKeywordArguments: false
  IgnoreEmptyMethods: true
  IgnoreNotImplementedMethods: true

# a ? (b ? c : d) : e is unreadable. Use if/else.
Style/NestedTernaryOperator:
  Enabled: true

# def process(data, include_extras = false) -> callers see process(data, true).
# What does true mean? Use keyword args: process(data, include_extras: true).
Style/OptionalBooleanParameter:
  Enabled: true

# def calculate(a, b, c) is cryptic. Use real names.
# Common 2-letter names (id, db, io) are allowed. x, y, z are forbidden.
Naming/MethodParameterName:
  Enabled: true
  MinNameLength: 2
  AllowedNames: [id, ip, to, by, on, in, at, io, db]
  ForbiddenNames: [x, y, z]

# a, b, c = 1, 2, 3 is harder to read than three separate lines.
# Exception: x, y = y, x for swaps is fine (cop handles this).
Style/ParallelAssignment:
  Enabled: true

# =============================================================================
# Custom Claude Cops
# =============================================================================

Claude/NoFancyUnicode:
  Enabled: true
  Description: "Avoid fancy Unicode. Use standard ASCII or add to AllowedUnicode."
  AllowedUnicode: []
  AllowInStrings: false
  AllowInComments: false
  Exclude:
    - '**/no_fancy_unicode.rb'
    - '**/no_fancy_unicode_spec.rb'

Claude/TaggedComments:
  Enabled: true
  Description: "Comments need attribution. Use format: # TAG: [@handle] description"
  Keywords:
    - TODO
    - FIXME
    - NOTE
    - HACK
    - OPTIMIZE
    - REVIEW

Claude/NoCommentedCode:
  Enabled: true
  Description: "Delete commented-out code instead of leaving it. Version control preserves history."
  MinLines: 1
  AllowKeep: true

Claude/NoBackwardsCompatHacks:
  Enabled: true
  Description: "Delete dead code. Don't preserve it for backwards compatibility."
  CheckUnderscoreAssignments: false

Claude/NoOverlyDefensiveCode:
  Enabled: true
  Description: "Trust internal code. Remove unnecessary defensive patterns."
  MaxSafeNavigationChain: 1
  AddSafeNavigator: false

Claude/ExplicitVisibility:
  Enabled: true
  Description: "Use explicit visibility. Group private methods under `private` keyword."
  EnforcedStyle: grouped

Claude/MysteryRegex:
  Enabled: true
  Description: "Extract long regex to a named constant. Complex patterns deserve descriptive names."
  MaxLength: 25

Claude/NoHardcodedLineNumbers:
  Enabled: true
  Description: "Avoid hardcoded line numbers. They become stale when code shifts."
  CheckComments: true
  CheckStrings: true
  MinLineNumber: 1
  Exclude:
    - '**/no_hardcoded_line_numbers.rb'
    - '**/no_hardcoded_line_numbers_spec.rb'
